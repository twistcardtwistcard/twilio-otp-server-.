<div style="max-width: 400px; margin: auto; text-align: left; font-family: sans-serif;">
  <h3>Vérification TWIST</h3>

  <label for="phone">Numéro de téléphone</label><br>
  <input
    type="tel"
    id="phone"
    placeholder="14185551234"
    style="width: 100%; padding: 8px; margin: 6px 0;"
    required
  ><br>

  <button onclick="sendOTP()" style="padding: 10px 15px; margin-bottom: 10px;">
    Envoyer le code
  </button><br>

  <label for="otp">Code reçu</label><br>
  <input
    type="text"
    id="otp"
    placeholder="123456"
    style="width: 100%; padding: 8px; margin: 6px 0;"
  ><br>

  <button onclick="verifyOTP()" style="padding: 10px 15px;">
    Vérifier
  </button>

  <div id="result" style="margin-top: 15px; font-weight: bold;"></div>
</div>

<script>
  const otpServer = "https://twilio-otp-server.onrender.com";

  async function sendOTP() {
    const phone = document.getElementById('phone').value.trim();

    try {
      const res = await fetch(`${otpServer}/send-otp`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ phone })
      });

      const data = await res.json();
      if (data.success) {
        document.getElementById('result').innerText = 'Code envoyé.';
      } else {
        document.getElementById('result').innerText = 'Erreur lors de l’envoi du code.';
      }
    } catch (error) {
      console.error('Erreur lors de l’envoi du code:', error);
      document.getElementById('result').innerText = 'Erreur de connexion.';
    }
  }

  async function verifyOTP() {
    const phone = document.getElementById('phone').value.trim();
    const code = document.getElementById('otp').value.trim();

    try {
      const res = await fetch(`${otpServer}/verify-otp`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ phone, code })
      });

      const data = await res.json();

      if (!data.success) {
        document.getElementById('result').innerText = 'Code invalide.';
        return;
      }

      if (data.middle4) {
        document.getElementById('result').innerHTML = `
          Vérification réussie<br>
          <strong>TWIST code :</strong> ${data.middle4}
        `;
      } else {
        document.getElementById('result').innerText = data.message || 'Aucun code TWIST trouvé pour ce numéro.';
      }
    } catch (error) {
      console.error('Erreur lors de la vérification du code:', error);
      document.getElementById('result').innerText = 'Erreur de connexion.';
    }
  }
</script>
